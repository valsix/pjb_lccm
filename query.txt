UPDATE public.pengguna_modul
	SET  menu_modul='Setting Peran'
	WHERE kode_modul='0801';

    ALTER TABLE public.log_generate
    ADD COLUMN berhasil_generate character varying ;
    
    ALTER TABLE public.log_generate
    ADD COLUMN gagal_generate character varying ;

CREATE TABLE IF NOT EXISTS public.pengguna_hak_distrik
(
    pengguna_hak_distrik_id numeric NOT NULL,
    pengguna_hak_id numeric,
    distrik_id numeric,
    status_all integer,
    last_create_user character varying COLLATE pg_catalog."default",
    last_create_date date,
    last_update_user character varying COLLATE pg_catalog."default",
    last_update_date date,
    CONSTRAINT pengguna_hak_distrik_pkey PRIMARY KEY (pengguna_hak_distrik_id)
);


CREATE OR REPLACE FUNCTION public.preparation_status_info()
    RETURNS trigger
    LANGUAGE 'plpgsql'
    COST 100
    VOLATILE NOT LEAKPROOF
AS $BODY$
declare
    kode_distrik character varying;
    kode_blok character varying;
    kode_unit_m character varying;
    year_lccm integer;
    wo_cr boolean;
    wo_standing boolean;
    wo_pm boolean;
    wo_pdm boolean;
    wo_oh boolean;
    prk boolean;
    loss_output boolean;
    energy_price boolean;
    operation boolean;
    status_complete boolean;
    
begin

    status_complete:= 'false';
    if new.wo_cr = 'true' 
    and new.wo_standing = 'true' 
    and new.wo_pm = 'true' 
    and new.wo_pdm = 'true' 
    and new.wo_oh = 'true' 
    and new.prk = 'true'
    and new.loss_output = 'true'
    and new.energy_price = 'true'
    and new.operation = 'true'
    then
        status_complete:= 'true';
        else
        status_complete:= 'false';
    end if;
   -- raise notice 'sql %',status_complete;
    new.status_complete:= status_complete;

  return new;
   
end;
$BODY$;

ALTER FUNCTION public.preparation_status_info()
    OWNER TO postgres;



CREATE TRIGGER tpreparation_status_info
    BEFORE INSERT OR UPDATE 
    ON public.t_preperation_lccm
    FOR EACH ROW
    EXECUTE PROCEDURE public.preparation_status_info();


    ALTER TABLE public.pengguna
    ADD COLUMN nid character varying ;
    
    ALTER TABLE public.pengguna
    ADD COLUMN nama_lengkap character varying;
    
    ALTER TABLE public.pengguna
    ADD COLUMN occup_status character varying ;
    
    ALTER TABLE public.pengguna
    ADD COLUMN kode_bagian character varying ;
    
    ALTER TABLE public.pengguna
    ADD COLUMN bagian character varying ;
    
    
    ALTER TABLE public.pengguna
    ADD COLUMN kode_ditbid character varying; 
    
    ALTER TABLE public.pengguna
    ADD COLUMN ditbid character varying ;
    
    ALTER TABLE public.pengguna
    ADD COLUMN kode_unit character varying ;
    
    
    ALTER TABLE public.pengguna
    ADD COLUMN unit character varying ;
    
    ALTER TABLE public.pengguna
    ADD COLUMN kode_klasifikasi_unit character varying ;
    
    ALTER TABLE public.pengguna
    ADD COLUMN klasifikasi_unit character varying ;
    
    ALTER TABLE public.pengguna
    ADD COLUMN position_id character varying ;
    
    ALTER TABLE public.pengguna
    ADD COLUMN nama_posisi character varying ;


    ALTER TABLE pengguna 
    ALTER COLUMN username DROP NOT NULL;


    ALTER TABLE public.pengguna
    ADD COLUMN expired_date date;

    ALTER TABLE public.pengguna
    ADD COLUMN no_telp numeric;

    ALTER TABLE public.pengguna
    ADD COLUMN distrik_id numeric;

    ALTER TABLE public.pengguna
    ADD COLUMN perusahaan_eksternal_id numeric;

    ALTER TABLE public.pengguna
    ADD COLUMN kode_distrik character varying(8) ;
    ALTER TABLE public.pengguna
    ADD COLUMN kode_blok character varying(8) ;
    ALTER TABLE public.pengguna
    ADD COLUMN kode_unit_m character varying(8) ;

    ALTER TABLE pengguna ADD CONSTRAINT pengguna_nid_u UNIQUE (nid);


    -- check dulu apakah ada data duplikat nid/username

    select nid, count(*)
    from pengguna
    group by nid
    HAVING count(*) > 1


    delete from pengguna pl
    where exists
    (
      select null
      from pengguna pl2
      where pl2.nid = pl.nid
      and pl2.ctid > pl.ctid
    )


    ALTER TABLE public.pengguna
    ADD COLUMN master_pass character varying ;

    ALTER TABLE pengguna ALTER COLUMN foto TYPE text;


    INSERT INTO public.m_oh_type_lccm(
    oh_type, description)
    VALUES ('CI', 'Combustor Inspection');
    
    INSERT INTO public.m_oh_type_lccm(
    oh_type, description)
    VALUES ('TI', 'Turbine Inspection');
    
    INSERT INTO public.m_oh_type_lccm(
    oh_type, description)
    VALUES ('MI', 'Major Inspection');
    
    INSERT INTO public.m_oh_type_lccm(
    oh_type, description)
    VALUES ('TO', 'Top Overhaul');
    
    INSERT INTO public.m_oh_type_lccm(
    oh_type, description)
    VALUES ('SO', 'Semi Overhaul');
    
    INSERT INTO public.m_oh_type_lccm(
    oh_type, description)
    VALUES ('MO', 'Major Overhaul');
    
    

